!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lodash"),require("circular-json")):"function"==typeof define&&define.amd?define(["exports","lodash","circular-json"],t):t((e=e||self).TypeMoq={},e._,e.CircularJSON)}(this,function(s,p,n){"use strict";var e,t;(e=s.MockBehavior||(s.MockBehavior={}))[e.Loose=0]="Loose",e[e.Strict=1]="Strict",(t=s.ExpectedCallType||(s.ExpectedCallType={}))[t.InAnyOrder=0]="InAnyOrder",t[t.InSequence=1]="InSequence";var r,o,i=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=(o=Error,i(c,o),c.prototype.toString=function(){return this.message?this.name+" - "+this.message:this.name},c);function c(e,t){var n=o.call(this,t)||this;return n.name=e,Object.setPrototypeOf(n,c.prototype),n}var u,l,f,h=(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});(f=l=l||{})[f.NoSetup="no setup expression found for"]="NoSetup",f[f.MoreThanOneSetup="more than one setup expression found for"]="MoreThanOneSetup",f[f.InvalidArg="invalid argument"]="InvalidArg",f[f.InvalidSetup="invalid setup expression"]="InvalidSetup",f[f.InvalidMatcher="invalid matching expression"]="InvalidMatcher",f[f.UnknownGlobalType="unknown global type"]="UnknownGlobalType",f[f.CallCountVerificationFailed="invocation count verification failed"]="CallCountVerificationFailed",f[f.CallOrderVerificationFailed="invocation order verification failed"]="CallOrderVerificationFailed",f[f.InvalidDynamicProxyRuntime="invalid dynamic proxy runtime"]="InvalidDynamicProxyRuntime";var y,_=(h(d,y=a),d.prototype.toString=function(){var e=this.name+" - "+this.reason;return this.message&&(e=e+" ("+this.message+")"),e},d);function d(e,t,n){void 0===n&&(n=void 0);var r=y.call(this,"MockException",n)||this;return r.reason=e,r.ctx=t,r.message=n,Object.setPrototypeOf(r,d.prototype),r}var v=(m.prototype.failMessage=function(e){return this._failMessage({i:e,min:this.min,max:this.max,c:this._lastCallCount})},m.prototype.verify=function(e){return this._lastCallCount=e,this._condition(e)},m.checkArg=function(e,t){if(e<0)throw new _(l.InvalidArg,void 0,t+" argument cannot be a negative number")},m.exactly=function(t){return m.checkArg(t,"'Times.exactly'"),new m(function(e){return e===t},t,t,m.NO_MATCHING_CALLS_EXACTLY_N_TIMES)},m.atLeast=function(t){return m.checkArg(t,"'Times.atLeast'"),new m(function(e){return t<=e},t,255,m.NO_MATCHING_CALLS_AT_LEAST_N_TIMES)},m.atMost=function(t){return m.checkArg(t,"'Times.atMost'"),new m(function(e){return 0<=e&&e<=t},0,t,m.NO_MATCHING_CALLS_AT_MOST_N_TIMES)},m.never=function(){return m.exactly(0)},m.once=function(){return m.exactly(1)},m.atLeastOnce=function(){return m.atLeast(1)},m.atMostOnce=function(){return m.atMost(1)},m.prototype.toString=function(){return this.min===this.max?0===this.min?"never":1===this.min?"once":this.min+" times":0===this.min&&255!==this.max?"at most "+this.max+" times":"at least "+this.min+" times"},m.NO_MATCHING_CALLS_EXACTLY_N_TIMES="expected invocation of <%= i %> exactly <%= min %> times, invoked <%= c %> times",m.NO_MATCHING_CALLS_AT_LEAST_N_TIMES="expected invocation of <%= i %> at least <%= min %> times, invoked <%= c %> times",m.NO_MATCHING_CALLS_AT_MOST_N_TIMES="expected invocation of <%= i %> at most <%= max %> times, invoked <%= c %> times",m);function m(e,t,n,r){this._condition=e,this.min=t,this.max=n,this._failMessage=p.template(r)}var b=(g.getOwnEnumerables=function(e){return this._getPropertyNames(e,!0,!1,this._enumerable)},g.getOwnNonenumerables=function(e){return this._getPropertyNames(e,!0,!1,this._notEnumerable)},g.getOwnEnumerablesAndNonenumerables=function(e){return this._getPropertyNames(e,!0,!1,this._enumerableAndNotEnumerable)},g.getPrototypeEnumerables=function(e){return this._getPropertyNames(e,!1,!0,this._enumerable)},g.getPrototypeNonenumerables=function(e){return this._getPropertyNames(e,!1,!0,this._notEnumerable)},g.getPrototypeEnumerablesAndNonenumerables=function(e){return this._getPropertyNames(e,!1,!0,this._enumerableAndNotEnumerable)},g.getOwnAndPrototypeEnumerables=function(e){return this._getPropertyNames(e,!0,!0,this._enumerable)},g.getOwnAndPrototypeNonenumerables=function(e){return this._getPropertyNames(e,!0,!0,this._notEnumerable)},g.getOwnAndPrototypeEnumerablesAndNonenumerables=function(e){return this._getPropertyNames(e,!0,!0,this._enumerableAndNotEnumerable)},g._enumerable=function(e,t){return e.propertyIsEnumerable(t)},g._notEnumerable=function(e,t){return!e.propertyIsEnumerable(t)},g._enumerableAndNotEnumerable=function(e,t){return!0},g._getPropertyNames=function(n,e,t,r){var o=[];do{if(e)for(var i=function(t){if(!p.find(o,function(e){return e.name===t})&&r(n,t)){var e=Object.getOwnPropertyDescriptor(n,t);o.push({name:t,desc:e})}},a=0,c=Object.getOwnPropertyNames(n);a<c.length;a++)i(c[a]);if(!t)break;e=!0}while(n=Object.getPrototypeOf(n));return o},g);function g(){}var C=(O.IMATCH_ID_VALUE="438A51D3-6864-49D7-A655-CA1153B86965",O.IMATCH_ID_NAME="___id",O.IMATCH_MATCHES_NAME="___matches",O.IPROXY_ID_VALUE="BCDF5CE5-F0DF-40B7-8BA0-69DF395033C8",O.IPROXY_ID_NAME="___id",O);function O(){}var I=(w.isMatcher=function(e){return!p.isNil(e)&&!p.isUndefined(e[C.IMATCH_MATCHES_NAME])&&!p.isUndefined(e[C.IMATCH_ID_NAME])&&e[C.IMATCH_ID_NAME]===C.IMATCH_ID_VALUE},w);function w(){}var P=(x.functionName=function(e){var t;if(e.name)t=e.name;else{var n=e.toString();t=(n=n.substr("function ".length)).substr(0,n.indexOf("("))}return t},x.objectName=function(e){return x.functionName(e.constructor)},x.argsName=function(e){var t=Array.prototype.slice.call(e).map(function(e){return I.isMatcher(e)?e.toString():n.stringify(e,function(e,t){return void 0===t?"undefined":p.isFunction(t)?"Function":t})});return p.join(t)},x.conthunktor=function(e,t){return new(e.bind.apply(e,[void 0].concat(t)))},x.clone=function(e,t){for(var n=0,r=b.getOwnAndPrototypeEnumerablesAndNonenumerables(t);n<r.length;n++){var o=r[n];Object.defineProperty(e,o.name,o.desc)}},x);function x(){}var A=(N.prototype.___matches=function(e){var t=!1;return e&&e.constructor.prototype==this._ctor.prototype&&(t=!0),t},N.prototype.toString=function(){return"It.isAnyObject("+P.functionName(this._ctor)+")"},N);function N(e){this._ctor=e,this.___id=C.IMATCH_ID_VALUE}var T=(E.prototype.___matches=function(e){return!0},E.prototype.toString=function(){return"It.isAny()"},E);function E(){this.___id=C.IMATCH_ID_VALUE}var S=(j.prototype.___matches=function(e){var t=!1;return p.isString(e)&&(t=!0),t},j.prototype.toString=function(){return"It.isAnyString()"},j);function j(){this.___id=C.IMATCH_ID_VALUE}var k=(M.prototype.___matches=function(e){var t=!1;return p.isNumber(e)&&(t=!0),t},M.prototype.toString=function(){return"It.isAnyNumber()"},M);function M(){this.___id=C.IMATCH_ID_VALUE}var V=(D.prototype.___matches=function(e){var t=!1;return e&&this._pred(e)&&(t=!0),t},D.prototype.toString=function(){return"It.is("+this._pred+")"},D);function D(e){this._pred=e,this.___id=C.IMATCH_ID_VALUE}var U=(F.prototype.___matches=function(e){var t=!1;return p.isEqual(this._value,e)&&(t=!0),t},F.prototype.toString=function(){return"It.isValue("+P.argsName([this._value])+")"},F);function F(e){this.___id=C.IMATCH_ID_VALUE,this._value=p.cloneDeep(e)}var L,B,R,Y,H=(q.prototype.___matches=function(e){var t=!1,n=p.pick(e,p.keys(this._value));return p.isEqual(this._value,n)&&(t=!0),t},q.prototype.toString=function(){return"It.isObjectWith("+P.argsName([this._value])+")"},q);function q(e){this.___id=C.IMATCH_ID_VALUE,this._value=p.cloneDeep(e)}(B=L=L||{})[B.UNKNOWN=0]="UNKNOWN",B[B.PROPERTY=1]="PROPERTY",B[B.FUNCTION=2]="FUNCTION",(Y=R=R||{})[Y.STATIC=0]="STATIC",Y[Y.DYNAMIC=1]="DYNAMIC";var G,X,W,K=(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}G(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});(W=X=X||{})[W.NONE=0]="NONE",W[W.SETUP=1]="SETUP",W[W.EXECUTE=2]="EXECUTE";var J=(Object.defineProperty(z.prototype,"isAnUnknownDynamicCallAtExecution",{get:function(){return this.proxyType==R.DYNAMIC&&this.callType==L.UNKNOWN&&this.invocationType==X.EXECUTE},enumerable:!0,configurable:!0}),z);function z(e,t){this.proxyType=e,this.callType=t,this.invocationType=X.NONE}var Q,Z=(K($,Q=J),Object.defineProperty($.prototype,"args",{get:function(){return this._args||{length:0,callee:null}},set:function(e){this._args=e},enumerable:!0,configurable:!0}),Object.defineProperty($.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),$.prototype.invokeBase=function(){var e={};this._that?P.clone(e,this._that):e=this._property.obj,this.returnValue=this._property.toFunc.apply(e,this._args)},$.prototype.toString=function(){return this.property+"("+P.argsName(this.args)+")"},$);function $(e,t,n,r,o){void 0===r&&(r=R.STATIC),void 0===o&&(o=L.FUNCTION);var i=Q.call(this,r,o)||this;return i._that=e,i._property=t,n&&(i._args=p.cloneDeep(n),i._args.length=n.length,i._args.callee=n.callee),i}var ee,te=(K(ne,ee=J),Object.defineProperty(ne.prototype,"args",{get:function(){var e=[];return Object.defineProperty(e,"callee",{configurable:!0,enumerable:!0,writable:!1,value:null}),e},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),ne.prototype.invokeBase=function(){this.returnValue=this._property.obj[this._property.name]},ne.prototype.toString=function(){return""+this.property},ne);function ne(e,t,n,r){void 0===n&&(n=R.STATIC),void 0===r&&(r=L.PROPERTY);var o=ee.call(this,n,r)||this;return o._property=e,o.value=t,o.returnValue=p.cloneDeep(t),o}var re,oe=(K(ie,re=te),ie);function ie(e,t){var n=re.call(this,e,t,R.DYNAMIC,L.UNKNOWN)||this;return n.returnValue=p.cloneDeep(t),n}var ae,ce=(K(ue,ae=J),Object.defineProperty(ue.prototype,"args",{get:function(){return this._args},set:function(e){this._args=e},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),ue.prototype.invokeBase=function(){this._property.obj[this._property.name]=this._args[0],this.returnValue=this._property.obj[this._property.name]},ue.prototype.toString=function(){return this.property+" = "+P.argsName(this.args[0])},ue);function ue(e,t,n,r){void 0===n&&(n=R.STATIC),void 0===r&&(r=L.PROPERTY);var o=ae.call(this,n,r)||this;return o._property=e,o._args=p.cloneDeep(t),o._args.length=t.length,o._args.callee=t.callee,o}var se,pe=(K(le,se=J),Object.defineProperty(le.prototype,"args",{get:function(){var e=[];return Object.defineProperty(e,"callee",{configurable:!0,enumerable:!0,writable:!1,value:null}),e},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),le.prototype.invokeBase=function(){this.returnValue=this._property.obj[this._property.name]},le.prototype.toString=function(){return""+this.property},le);function le(e,t,n,r){void 0===n&&(n=R.STATIC),void 0===r&&(r=L.FUNCTION);var o=se.call(this,n,r)||this;return o._property=e,o._getter=t,o}var fe,he=(K(ye,fe=J),Object.defineProperty(ye.prototype,"args",{get:function(){return this._args},set:function(e){this._args=e},enumerable:!0,configurable:!0}),Object.defineProperty(ye.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),ye.prototype.invokeBase=function(){this._property.obj[this._property.name]=this._args[0],this.returnValue=this._property.obj[this._property.name]},ye.prototype.toString=function(){return this.property+"("+P.argsName(this.args[0])+")"},ye);function ye(e,t,n,r,o){void 0===r&&(r=R.STATIC),void 0===o&&(o=L.FUNCTION);var i=fe.call(this,r,o)||this;return i._property=e,i._setter=t,i._args=p.cloneDeep(n),i._args.length=n.length,i._args.callee=n.callee,i}var _e=(Object.defineProperty(de.prototype,"toFunc",{get:function(){return p.isFunction(this.obj)?this.obj:this.obj[this.name]},enumerable:!0,configurable:!0}),de.prototype.toString=function(){var e=P.objectName(this.obj);return p.isFunction(this.obj)?""+e:e+"."+this.name},de);function de(e,t,n){this.obj=e,this.name=t,n&&(this.desc=p.cloneDeep(n))}var ve=(me.prototype.toString=function(){return P.objectName(this.obj)+"."+this.name},me);function me(e,t,n){this.obj=e,this.name=t,n&&(this.desc=p.cloneDeep(n))}var be=(ge.of=function(e,t){var n;if(ge.check(e),p.isFunction(e)){var r=P.functionName(e);n=ge.methodProxyValue(void 0,t,e,r,null)}else n=new ge(e,t);return n},ge.isProxy=function(e){return!p.isNil(e)&&!p.isUndefined(e[C.IPROXY_ID_NAME])&&e[C.IPROXY_ID_NAME]===C.IPROXY_ID_VALUE},ge.check=function(e){ge.checkNotNullOrUndefined(e);var t=!1;if((p.isFunction(e)||p.isObject(e)&&!ge.isPrimitiveObject(e))&&(t=!0),!t)throw new _(l.InvalidArg,e,"'"+e+"'; proxy argument should be a function or a non primitive object")},ge.prototype.check=function(e){ge.checkNotNullOrUndefined(e);var t=!1;if(p.isFunction(e)||!p.isObject(e)||ge.isPrimitiveObject(e)||(t=!0),!t)throw new _(l.InvalidArg,e,"'"+e+"'; proxy argument should be a non primitive object")},ge.checkNotNullOrUndefined=function(e){if(p.isNil(e))throw new _(l.InvalidArg,e,"'"+e+"'; proxy argument is required")},ge.isPrimitiveObject=function(e){var t=!1;return(p.isFunction(e)||p.isArray(e)||p.isDate(e)||p.isNull(e))&&(t=!0),t},ge.prototype.defineMethodProxy=function(e,t,n,r,o){void 0===o&&(o={configurable:!0,enumerable:!0,writable:!1}),o.value=ge.methodProxyValue(e,t,n,r,o),this.defineProperty(e,r,o)},ge.methodProxyValue=function(n,r,o,i,a){return function(){var e=new _e(o,i,a),t=new Z(n,e,arguments);return r.intercept(t),t.returnValue}},ge.prototype.defineValuePropertyProxy=function(e,r,o,i,n,t){void 0===t&&(t={configurable:!0,enumerable:!0}),t.get=function(){var e=new ve(o,i),t=new te(e,n);return r.intercept(t),t.returnValue},t.set=function(e){var t=new ve(o,i),n=new ce(t,arguments);r.intercept(n)},this.defineProperty(e,i,t)},ge.prototype.defineGetSetPropertyProxy=function(e,r,o,i,n,a,t){void 0===t&&(t={configurable:!0,enumerable:!0}),t.get=function(){var e=new ve(o,i),t=new pe(e,n);return r.intercept(t),t.returnValue},t.set=function(e){var t=new ve(o,i),n=new he(t,a,arguments);r.intercept(n)},this.defineProperty(e,i,t)},ge.prototype.defineProperty=function(e,t,n){try{Object.defineProperty(e,t,n)}catch(e){console.log(e.message)}},ge);function ge(n,r){var o=this;this.___id=C.IPROXY_ID_VALUE,this.check(n);var i=this,e=b.getOwnAndPrototypeEnumerablesAndNonenumerables(n);p.each(e,function(e){if(p.isFunction(e.desc.value)){var t={configurable:e.desc.configurable,enumerable:e.desc.enumerable,writable:e.desc.writable};o.defineMethodProxy(i,r,n,e.name,t)}else{t={configurable:e.desc.configurable,enumerable:e.desc.enumerable};void 0!==e.desc.value?o.defineValuePropertyProxy(i,r,n,e.name,e.desc.value,t):o.defineGetSetPropertyProxy(i,r,n,e.name,e.desc.get,e.desc.set,t)}})}var Ce=(Oe.of=function(e,t){return Oe.check(),new Oe(e,t)},Oe.check=function(){if("undefined"==typeof Proxy)throw new _(l.InvalidDynamicProxyRuntime,null,"ES6 Proxy object not detected; the dynamic mocking feature requires ES6 Proxy object support")},Oe);function Oe(e,t){this.___id=C.IPROXY_ID_VALUE;var n=new Proxy(e,t);return n[Symbol.toStringTag]=Function.prototype.toString.bind(e),n}var Ie=(we.prototype.apply=function(e,t,n){var r=P.functionName(e),o=new _e(e,r),i=new Z(e,o,n,R.DYNAMIC);return this._interceptor.intercept(i),i.returnValue},we.prototype.get=function(o,i,e){var a=this;if(i===Symbol.toStringTag||i===Symbol.toPrimitive||"toJSON"===i)return Reflect.get(o,i,e);var t=o[i],n=new ve(o,i),c=new oe(n,t);return this._interceptor.intercept(c),c.callType==L.PROPERTY&&c.property.desc?c.returnValue:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a._interceptor.removeInvocation(c);var n=new _e(o,i),r=new Z(o,n,e,R.DYNAMIC);return a._interceptor.intercept(r),r.returnValue}},we.prototype.set=function(e,t,n,r){if(t!==Symbol.toStringTag){var o=new ve(e,t),i=new ce(o,[n],R.DYNAMIC);this._interceptor.intercept(i)}return Reflect.set(e,t,n,r)},we.prototype.defineProperty=function(e,t,n){return n.configurable=!0,Reflect.defineProperty(e,t,n)},we);function we(e){this._interceptor=e}var Pe=(xe.createProxy=function(e,t){return be.of(e,t)},xe.createProxyES6=function(e,t){var n=new Ie(t);return Ce.of(e,n)},xe);function xe(){}var Ae,Ne,Te=(Object.defineProperty(Ee.prototype,"object",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"callBase",{get:function(){return this._callBase},set:function(e){this._callBase=e},enumerable:!0,configurable:!0}),Ee.prototype.generateId=function(){return"Mock<"+p.uniqueId()+">"},Ee.prototype.getNameOf=function(e){var t;if(p.isFunction(e))t=P.functionName(e);else if(p.isObject(e)){var n=e.constructor;t=P.functionName(n)}return t=t&&t.trim()},Ee.prototype.verifyAll=function(){try{this._interceptor.verify()}catch(e){throw e}},Ee.prototype.reset=function(){this._interceptor.reset()},Ee);function Ee(e,t,n){void 0===n&&(n=s.MockBehavior.Loose),this.target=e,this.canOverrideTarget=t,this.behavior=n,this._id=this.generateId(),this._name=this.getNameOf(this.target)}(Ne=Ae=Ae||{})[Ne.Continue=0]="Continue",Ne[Ne.Stop=1]="Stop";var Se=(Object.defineProperty(je.prototype,"behavior",{get:function(){return this.mock.behavior},enumerable:!0,configurable:!0}),je.prototype.addInvocation=function(e){this._actualInvocations.push(e)},je.prototype.removeInvocation=function(t){p.remove(this._actualInvocations,function(e){return e===t})},je.prototype.actualInvocations=function(){return this._actualInvocations},je.prototype.clearInvocations=function(){this._actualInvocations.splice(0,this._actualInvocations.length)},je.prototype.addExpectedCall=function(e){this._expectedCalls.push(e)},je.prototype.removeExpectedCall=function(t){p.filter(this._expectedCalls,function(e){return e.id!==t.id})},je.prototype.expectedCalls=function(){return this._expectedCalls},je.prototype.clearExpectedCalls=function(){this._expectedCalls.splice(0,this._expectedCalls.length)},je.prototype.reset=function(){this.clearInvocations(),this.clearExpectedCalls()},je);function je(e){this.mock=e,this._actualInvocations=[],this._expectedCalls=[]}var ke=function(){},Me=(Ve.prototype.handleIntercept=function(e,t,n){return t.addInvocation(e),Ae.Continue},Ve);function Ve(){}var De=(Ue.prototype.handleIntercept=function(t,e,n){var r=e.expectedCalls().slice(),o=function(e){return e.matches(t)};if(1<p.filter(r,function(e){return o(e)}).length&&(o=function(e){return!e.isInvoked&&e.matches(t)}),n.call=p.find(r,function(e){return o(e)}),null!=n.call){if(t.isAnUnknownDynamicCallAtExecution&&(t.callType=n.call.setupCall.callType,t.callType==L.FUNCTION))return Ae.Stop;n.call.evaluatedSuccessfully()}else if(e.behavior==s.MockBehavior.Strict)throw new _(l.NoSetup,t,"'"+t+"'");return Ae.Continue},Ue);function Ue(){}var Fe=(Le.prototype.handleIntercept=function(e,t,n){this._ctx=t;var r=n.call;return null!=r?(r.execute(e),Ae.Stop):Ae.Continue},Le);function Le(){}var Be=(Re.prototype.handleIntercept=function(e,t,n){return t.mock.callBase?(e.invokeBase(),Ae.Stop):Ae.Continue},Re);function Re(){}var Ye=(He.prototype.handleIntercept=function(e,t,n){return Ae.Continue},He);function He(){}var qe=(Object.defineProperty(Ge.prototype,"interceptorContext",{get:function(){return this._interceptorContext},enumerable:!0,configurable:!0}),Ge.prototype.intercept=function(t){var n=this,r=new ke;t.invocationType=X.EXECUTE,p.some(this.interceptionStrategies(),function(e){if(Ae.Stop===e.handleIntercept(t,n.interceptorContext,r))return!0})},Ge.prototype.removeInvocation=function(e){this._interceptorContext.removeInvocation(e)},Ge.prototype.addExpectedCall=function(e){this._interceptorContext.addExpectedCall(e)},Ge.prototype.verify=function(){var e=this._interceptorContext.expectedCalls(),t=[];if(this._interceptorContext.behavior==s.MockBehavior.Strict)for(var n=0,r=e;n<r.length;n++){var o=r[n];o.isVerifiable||o.setVerifiable(),t.push(o)}else t=p.filter(e,function(e){return e.isVerifiable});for(var i=0,a=t;i<a.length;i++){var c=a[i];this.verifyCallCount(c,c.expectedCallCount)}var u=p.filter(e,function(e){return e.isInSequence});this.verifyCallsOrder(u)},Ge.prototype.verifyCallCount=function(t,e){var n=this._interceptorContext.expectedCalls(),r=this._interceptorContext.actualInvocations(),o=p.filter(r,function(e){return t.matches(e)}).length;e.verify(o)||this.throwVerifyCallCountException(t.setupCall,e,n,r)},Ge.prototype.throwVerifyCallCountException=function(e,t,n,r){var o=t.failMessage(e)+"\n Configured setups:\n"+n.reduce(function(e,t){return e+" "+t+"\n"},"")+"\n Performed invocations:\n"+r.reduce(function(e,t){return e+" "+t+"\n"},"");throw new _(l.CallCountVerificationFailed,e,o)},Ge.prototype.verifyCallsOrder=function(e){var t=this._interceptorContext.actualInvocations();this.checkCallOrderExpectations(e,t)},Ge.prototype.checkCallOrderExpectations=function(u,s){var r=!1,o=function(e,t){if(!r)if(t===u.length)r=function(e){for(var t=p.sum(e),n=0,r=0;r<e.length;r++)for(var o=u[r],i=e[r],a=1;a<=i;a++){var c=s[n++];if(!o.matches(c))return!1}return n===t}(e);else for(var n=u[t].expectedCallCount.min;n<=u[t].expectedCallCount.max;n++)e[t]=n,o(e,t+1)};o([],0),r||this.throwVerifyCallOrderException()},Ge.prototype.throwVerifyCallOrderException=function(){throw new _(l.CallOrderVerificationFailed,null)},Ge.prototype.reset=function(){this._interceptorContext.reset()},Ge.prototype.interceptionStrategies=function(){return[new Me,new De,new Fe,new Be,new Ye]},Ge);function Ge(e){this._interceptorContext=new Se(e)}var Xe=(Object.defineProperty(We.prototype,"interceptedCall",{get:function(){return this._interceptedCall},enumerable:!0,configurable:!0}),We.prototype.intercept=function(e){if(e.invocationType=X.SETUP,e.proxyType==R.DYNAMIC&&e.callType==L.UNKNOWN&&(e.callType=L.PROPERTY),this._interceptedCall)throw new _(l.MoreThanOneSetup,e,"'"+e+"'; setup should contain only one expression");this._interceptedCall=e},We.prototype.removeInvocation=function(e){this._interceptedCall&&this._interceptedCall===e&&(this._interceptedCall=void 0)},We);function We(){}var Ke=(Je.ofStaticMock=function(e,t){var n=new Xe;return new Je(e,t,n,Pe.createProxy(e.target,n))},Je.ofDynamicMock=function(e,t){var n=new Xe;return new Je(e,t,n,Pe.createProxyES6(e.target,n))},Je.prototype.generateId=function(){return"MethodCall<"+p.uniqueId()+">"},Je.prototype.transformToMatchers=function(e){var n=[];return p.each(e,function(t){if(p.isObject(t))I.isMatcher(t)?n.push(t):(e=new V(function(e){return p.isEqual(e,t)}),n.push(e));else{var e=new U(t);n.push(e)}}),n},Object.defineProperty(Je.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"setupExpression",{get:function(){return this._setupExpression},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"setupCall",{get:function(){return this._setupCall},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"isVerifiable",{get:function(){return this._isVerifiable},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"isInSequence",{get:function(){return this._expectedCallType===s.ExpectedCallType.InSequence},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"expectedCallCount",{get:function(){return this._expectedCallCount},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"isInvoked",{get:function(){return this._isInvoked},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"callCount",{get:function(){return this._callCount},enumerable:!0,configurable:!0}),Je.prototype.setVerifiable=function(e,t){void 0===e&&(e=v.once()),void 0===t&&(t=s.ExpectedCallType.InAnyOrder),this._isVerifiable=!0,this._expectedCallCount=e,this._expectedCallType=t},Je.prototype.evaluatedSuccessfully=function(){this._evaluatedSuccessfully=!0},Je.prototype.matches=function(o){var i=!1;return this._setupCall.property&&o&&o.property&&this._setupCall.property.name===o.property.name&&this._setupCall.args.length>=o.args.length&&(i=!0,o.isAnUnknownDynamicCallAtExecution||p.each(this._setupCall.args,function(e,t){var n=e,r=o.args[t];i&&!n.___matches(r)&&(i=!1)})),i},Je.prototype.execute=function(e){if(this._isInvoked=!0,null!=this._setupCallback&&this._setupCallback.apply(this,e.args),null!=this._thrownException)throw this._thrownException;this._callCount++},Je.prototype.verifiable=function(e,t){this.setVerifiable(e,t)},Je.prototype.toString=function(){var e=""+this.setupCall;return this.expectedCallCount&&(e=e+", "+this.expectedCallCount),e},Je);function Je(e,t,n,r){if(this.mock=e,this._setupExpression=t,this._callCount=0,this._id=this.generateId(),t(r),!n.interceptedCall)throw new _(l.InvalidSetup,this._setupExpression,"'"+this._setupExpression+"'");var o=n.interceptedCall,i=this.transformToMatchers(o.args);Object.defineProperty(i,"callee",{configurable:!0,enumerable:!0,writable:!1,value:o.args.callee}),o.args=i,this._setupCall=o}var ze,Qe,Ze=((ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}ze(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})($e,Qe=Ke),$e.ofStaticMock=function(e,t){var n=new Xe;return new $e(e,t,n,Pe.createProxy(e.target,n))},$e.ofDynamicMock=function(e,t){var n=new Xe;return new $e(e,t,n,Pe.createProxyES6(e.target,n))},$e.prototype.execute=function(e){Qe.prototype.execute.call(this,e),this._callBase?e.invokeBase():this.hasReturnValue&&(e.returnValue=this._returnValueFunc.apply(this,e.args),e.property.desc={value:this.setupCall.property.desc&&this.setupCall.property.desc.value})},$e.prototype.callback=function(e){return this._setupCallback=e,this},$e.prototype.throws=function(e){return this._thrownException=e,this},$e.prototype.returns=function(e){if(this._returnValueFunc=e,this.hasReturnValue=!0,this._overrideTarget){var t=this.mock.target,n=this.setupCall.property.name,r=this.setupCall.property.desc;r||this.setupCall.proxyType!=R.DYNAMIC?r&&(r.configurable=!0,r.enumerable=!0,r.value=this._returnValueFunc,Object.defineProperty(t,n,r)):(r={configurable:!0,enumerable:!0},this.setupCall.callType==L.FUNCTION?r.value=this._returnValueFunc:r.get=this._returnValueFunc,Object.defineProperty(t,n,r))}return this},$e.prototype.callBase=function(){return this._callBase=!0,this},$e);function $e(e,t,n,r){var o=Qe.call(this,e,t,n,r)||this;return o._overrideTarget=e.canOverrideTarget,o}var et,tt,nt=((et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}et(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(rt,tt=Te),rt.ofInstance=function(e,t,n){return e=rt.cloneDeep(e),new rt(e,n,t)},rt.ofGlobalInstance=function(e,t){return new rt(e,!1,t)},rt.ofType=function(e,t,n,r){return new rt(P.conthunktor(e,r),n,t)},rt.cloneDeep=function(e){var t=e;return p.isFunction(e)||(t=p.cloneDeepWith(e,function(e){if(be.isProxy(e))return e})),t},rt.prototype.setup=function(e){var t=Ze.ofStaticMock(this,e);return this._interceptor.addExpectedCall(t),t},rt.prototype.verify=function(e,t){var n=Ke.ofStaticMock(this,e);n.verifiable(t),this._interceptor.addExpectedCall(n);try{this._interceptor.verifyCallCount(n,t)}catch(e){throw e}},rt);function rt(e,t,n){var r=tt.call(this,e,t,n)||this;return r._interceptor=new qe(r),r._proxy=Pe.createProxy(e,r._interceptor),r}var ot,it,at=((ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}ot(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(ct,it=Te),ct.ofType=function(e,t,n){return new ct(function(){},e,n,t)},ct.prototype.setup=function(e){var t=Ze.ofDynamicMock(this,e);return this._interceptor.addExpectedCall(t),t},ct.prototype.verify=function(e,t){var n=Ke.ofDynamicMock(this,e);this._interceptor.addExpectedCall(n);try{this._interceptor.verifyCallCount(n,t)}catch(e){throw e}},ct);function ct(e,t,n,r){var o=it.call(this,e,n,r)||this;return t&&(o._name=t),o._interceptor=new qe(o),o._proxy=Pe.createProxyES6(e,o._interceptor),o}var ut=(st.ofInstance=function(e,t,n){return void 0===t&&(t=s.MockBehavior.Loose),void 0===n&&(n=!0),nt.ofInstance(e,t,n)},st.ofType=function(e,t,n){void 0===t&&(t=s.MockBehavior.Loose),void 0===n&&(n=!0);for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return e?st.ofType2(e,r,t,n):at.ofType(void 0,t,n)},st.ofType2=function(e,t,n,r){return void 0===n&&(n=s.MockBehavior.Loose),void 0===r&&(r=!0),nt.ofType(e,n,r,t)},st);function st(){}var pt,lt,ft=(ht.isValue=function(e){return new U(e)},ht.isObjectWith=function(e){return new H(e)},ht.isAnyObject=function(e){return new A(e)},ht.isAny=function(){return new T},ht.isAnyString=function(){return new S},ht.isAnyNumber=function(){return new k},ht.is=function(e){return new V(e)},ht);function ht(){}(lt=pt=pt||{})[lt.Class=0]="Class",lt[lt.Function=1]="Function",lt[lt.Value=2]="Value";var yt=(Object.defineProperty(_t.prototype,"object",{get:function(){return this.mock.object},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"target",{get:function(){return this.mock.target},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"name",{get:function(){return this._name||this.mock.name},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"behavior",{get:function(){return this.mock.behavior},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"callBase",{get:function(){return this.mock.callBase},set:function(e){this.mock.callBase=e},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),_t.prototype.setup=function(e){return this.mock.setup(e)},_t.prototype.verify=function(e,t){this.mock.verify(e,t)},_t.prototype.verifyAll=function(){this.mock.verifyAll()},_t.prototype.reset=function(){this.mock.reset()},_t);function _t(e,t,n,r){this.mock=e,this._name=t,this._type=n,this.container=r,this._name||(this._name=e.name)}var dt=(vt.ofInstance=function(e,t,n,r){void 0===n&&(n=window),void 0===r&&(r=s.MockBehavior.Loose);var o=nt.ofGlobalInstance(e,r),i=p.isFunction(e)?pt.Function:pt.Value;return new yt(o,t,i,n)},vt.ofType=function(e,t,n){void 0===t&&(t=window),void 0===n&&(n=s.MockBehavior.Loose);var r=new e,o=nt.ofInstance(r,n,!1);return new yt(o,void 0,pt.Class,t)},vt.ofType2=function(e,t,n){void 0===t&&(t=window),void 0===n&&(n=s.MockBehavior.Loose);var r=at.ofType(e,n,!1);return new yt(r,void 0,pt.Class,t)},vt);function vt(){}var mt=(bt.prototype.with=function(e){var o={};try{p.each(this._args,function(t){var e=b.getOwnAndPrototypeEnumerablesAndNonenumerables(t.container),n=p.find(e,function(e){return e.name===t.name});if(n){o[t.name]=n.desc;var r={};switch(t.type){case pt.Class:r.value=function(){return t.mock.object};break;case pt.Function:r.value=t.mock.object;break;case pt.Value:r.get=function(){return t.mock.object};break;default:throw new _(l.UnknownGlobalType,t,"unknown global type: "+t.type)}try{Object.defineProperty(t.container,t.name,r)}catch(e){console.log("1: "+e)}}}),e.apply(this,this._args)}catch(e){console.log("2: "+e)}finally{p.each(this._args,function(e){var t=o[e.name];if(t){switch(e.type){case pt.Class:case pt.Function:break;case pt.Value:t.configurable=!0}try{Object.defineProperty(e.container,e.name,t)}catch(e){console.log("3: "+e)}}})}},bt);function bt(e){this._args=e}var gt=(Ct.using=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new mt(e)},Ct);function Ct(){}s.Mock=ut,s.It=ft,s.Times=v,s.GlobalMock=dt,s.GlobalScope=gt,s.MockException=_,Object.defineProperty(s,"__esModule",{value:!0})});